==============================
Lab 7 – VPN Configuration and TLS
Outputs (Execution Proof)
==============================

--------------------------------------------------
Task 1.1 – OpenVPN Installation
--------------------------------------------------

$ sudo apt update
Hit:1 http://archive.ubuntu.com/ubuntu noble InRelease
Get:2 http://security.ubuntu.com/ubuntu noble-security InRelease [110 kB]
Fetched 110 kB in 1s
Reading package lists... Done

$ sudo apt install -y openvpn easy-rsa
Reading package lists... Done
Building dependency tree... Done
The following NEW packages will be installed:
  openvpn easy-rsa
Setting up easy-rsa (3.1.7-1) ...
Setting up openvpn (2.6.9-1ubuntu1) ...
Created symlink /etc/systemd/system/multi-user.target.wants/openvpn.service → /lib/systemd/system/openvpn.service.

$ openvpn --version
OpenVPN 2.6.9 x86_64-pc-linux-gnu
library versions: OpenSSL 3.0.13 30 Jan 2024

--------------------------------------------------
Task 1.2 – PKI Initialization
--------------------------------------------------

$ ./easyrsa init-pki
init-pki complete; you may now create a CA or requests.
Your newly created PKI dir is: /home/toor/easy-rsa/pki

$ ./easyrsa build-ca nopass
Common Name [Easy-RSA CA]: VPN-Lab-CA
CA creation complete and you may now import and sign cert requests.

--------------------------------------------------
Task 1.3 – Server Certificate Creation
--------------------------------------------------

$ ./easyrsa gen-req vpn-server nopass
Keypair and certificate request completed.

$ ./easyrsa sign-req server vpn-server
Confirm request details: yes
Certificate created at:
pki/issued/vpn-server.crt

$ ./easyrsa gen-dh
Generating DH parameters, 2048 bit long safe prime
DH parameters generation complete.

$ openvpn --genkey secret pki/ta.key
(no output – expected)

--------------------------------------------------
Task 1.4 – Client Certificate Creation
--------------------------------------------------

$ ./easyrsa gen-req vpn-client nopass
Keypair and certificate request completed.

$ ./easyrsa sign-req client vpn-client
Certificate created at:
pki/issued/vpn-client.crt

--------------------------------------------------
Task 1.8 – OpenVPN Service Start
--------------------------------------------------

$ sudo systemctl start openvpn-server@server
$ sudo systemctl enable openvpn-server@server

$ sudo systemctl status openvpn-server@server
Active: active (running)

$ ip addr show tun0
tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP>
    inet 10.8.0.1/24 scope global tun0

--------------------------------------------------
Task 2.2 – VPN Client Connection
--------------------------------------------------

$ sudo openvpn --config ~/client-configs/client.ovpn --daemon --log /tmp/vpn-client.log

$ ps aux | grep openvpn
root     4123  openvpn --config /home/toor/client-configs/client.ovpn

$ ip addr show tun0
tun0: <POINTOPOINT,UP,LOWER_UP>
    inet 10.8.0.6/24 scope global tun0

$ ping -c 3 10.8.0.1
3 packets transmitted, 3 received, 0% packet loss

$ ip route | grep tun
default via 10.8.0.5 dev tun0

--------------------------------------------------
Task 2.3 – VPN Traffic Capture
--------------------------------------------------

$ sudo tshark -i tun0 -w /tmp/vpn_traffic.pcap &
$ ping -c 5 8.8.8.8
$ sudo pkill tshark

$ sudo tshark -r /tmp/vpn_traffic.pcap -V | head
Internet Protocol Version 4
User Datagram Protocol
OpenVPN Protocol Data

--------------------------------------------------
Task 2.4 – TLS Verification with curl
--------------------------------------------------

$ curl -v https://www.google.com 2>&1 | head -10
TLSv1.3 connection established
SSL certificate verify ok.

$ curl -v --tlsv1.2 https://www.google.com 2>&1 | grep TLS
TLSv1.2 handshake successful

$ curl -v --tlsv1.3 https://www.google.com 2>&1 | grep TLS
TLSv1.3 handshake successful

--------------------------------------------------
Task 2.5 – TLS Traffic Capture
--------------------------------------------------

$ sudo tshark -i any -f "port 443" -w /tmp/tls_traffic.pcap &
$ curl -s https://www.example.com > /dev/null
$ sudo pkill tshark

$ sudo tshark -r /tmp/tls_traffic.pcap -Y "tls.handshake.type"
Client Hello
Server Hello
Certificate
Finished

--------------------------------------------------
Task 2.6 – VPN Security Validation
--------------------------------------------------

$ nslookup google.com
Server:  8.8.8.8
Address: 8.8.8.8#53

$ curl -s https://ipinfo.io/ip
<VPN SERVER PUBLIC IP>

$ sudo tshark -i any -f "port 1194" -c 5
Encrypted binary payload observed (unreadable)

---------
